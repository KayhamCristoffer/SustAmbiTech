<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fontes e Referências - SustAmbiTech</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos Gerais para o Formulário */
.main-content {
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.form-container h2 {
    color: #00796b; /* Cor primária do tema verde */
    text-align: center;
    margin-bottom: 5px;
}

.form-container p {
    text-align: center;
    color: #555;
    margin-bottom: 20px;
}

/* Fieldset e Legend */
fieldset {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 20px;
    margin-bottom: 25px;
}

legend {
    color: #00796b;
    font-weight: bold;
    padding: 0 10px;
}

/* Grupos de Formulário */
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box; /* Garante que o padding não aumente o width */
    font-size: 16px;
}

.form-group textarea {
    resize: vertical;
}

/* Layout Inline para CEP e Número */
.form-group-inline {
    display: flex;
    gap: 20px;
}

.form-group-inline .form-group {
    flex: 1; /* Divide o espaço igualmente */
}

/* Botão de Envio */
.submit-button {
    display: block;
    width: 100%;
    padding: 12px;
    background-color: #00796b; /* Cor primária */
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.submit-button:hover {
    background-color: #004d40; /* Tom mais escuro ao passar o mouse */
}

/* Mensagens de Feedback */
.message {
    text-align: center;
    margin-top: 15px;
    padding: 10px;
    border-radius: 4px;
    font-weight: bold;
}

.message.success {
    background-color: #e8f5e9;
    color: #388e3c;
}

.message.error {
    background-color: #ffebee;
    color: #d32f2f;
}
    </style>
</head>

<body>
    <div id="menu-container"></div>

    <section class="form-container">
    <h2>Sugerir Novo Ecoponto</h2>
    <p>Ajude a expandir nossa rede de coleta! Preencha os detalhes do local que você gostaria de ver adicionado.</p>

    <form id="sugestaoEcopontoForm">
        <fieldset>
            <legend>Detalhes do Local</legend>

            <div class="form-group">
                <label for="nomeLocal">Nome do Local/Ponto de Referência:</label>
                <input type="text" id="nomeLocal" name="nomeLocal" required placeholder="Ex: Praça Central, Estacionamento do Mercado">
            </div>

            <div class="form-group">
                <label for="tipoPonto">Tipo de Material Principal:</label>
                <select id="tipoPonto" name="tipoPonto" required>
                    <option value="">Selecione o Tipo</option>
                    <option value="Reciclagem">Reciclagem (Plástico, Papel, Vidro, Metal)</option>
                    <option value="Posto Eletro">Posto Eletro (Eletrônicos, Pilhas, Baterias)</option>
                    <option value="Óleo de Cozinha">Óleo de Cozinha Usado</option>
                    <option value="Medicamentos">Medicamentos Vencidos</option>
                    <option value="Outros">Outros (Especifique nas observações)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="endereco">Endereço Completo:</label>
                <input type="text" id="endereco" name="endereco" required placeholder="Ex: Av. Brasil">
            </div>

            <div class="form-group-inline">
                <div class="form-group">
                    <label for="numero">Número:</label>
                    <input type="text" id="numero" name="numero" required placeholder="123 ou S/N">
                </div>
                <div class="form-group">
                    <label for="cep">CEP:</label>
                    <input type="text" id="cep" name="cep" required maxlength="9" pattern="\d{5}-?\d{3}" placeholder="00000-000">
                </div>
            </div>
        </fieldset>
        
        <fieldset>
            <legend>Informações Adicionais</legend>
            <div class="form-group">
                <label for="observacoes">Observações (Opcional):</label>
                <textarea id="observacoes" name="observacoes" rows="3" placeholder="Qualquer detalhe extra sobre o acesso ou funcionamento do local..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="emailContato">Seu Email (Para contato sobre esta sugestão):</label>
                <input type="email" id="emailContato" name="emailContato" placeholder="seu.email@exemplo.com">
            </div>
        </fieldset>

        <button type="submit" class="submit-button">Enviar Sugestão de Ecoponto</button>

        <p id="form-message" class="message"></p>
    </form>
</section>
    </main>
    <br>
    <br>
    <br>
    <br>
    <div id="footer-container"></div>

    <script src="main.js" type="module"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer-container').innerHTML = data;
                })
                .catch(error => console.error('Erro ao carregar o rodapé:', error));
        });
    </script>
    <script>
        // Este código pode ser adicionado ao seu main.js (já que ele é type="module") 
// ou em um bloco <script> na página, dependendo da sua estrutura.

// **Presume-se que a autenticação do Firebase já esteja configurada e o usuário logado.**

import { getDatabase, ref, push, serverTimestamp } from 'firebase/database';

document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('sugestaoEcopontoForm');
    const messageDisplay = document.getElementById('form-message');

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            messageDisplay.textContent = '';
            messageDisplay.className = 'message';

            // 1. Obter o UID do usuário logado (MOCK/EXEMPLO)
            // Substitua esta linha pela lógica real de obtenção do UID
            const usuarioId = "SEU_UID_DE_EXEMPLO"; // <-- ATUALIZE COM A FUNÇÃO DE AUTENTICAÇÃO REAL

            if (usuarioId === "SEU_UID_DE_EXEMPLO" || !usuarioId) {
                messageDisplay.textContent = 'Erro: Você precisa estar logado para enviar uma sugestão.';
                messageDisplay.classList.add('error');
                return;
            }

            // 2. Coletar dados do formulário
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // 3. Formatar o objeto para o Firebase (conforme as regras)
            const novaSugestao = {
                usuarioId: usuarioId,
                nomeLocal: data.nomeLocal,
                tipoPonto: data.tipoPonto,
                endereco: data.endereco,
                numero: data.numero,
                cep: data.cep.replace(/[^0-9]/g, ''), // Limpa o CEP para apenas dígitos
                observacoes: data.observacoes || '',
                emailContato: data.emailContato || '',
                
                // Campos requeridos pelas regras do Firebase
                status: "pendente", // O status inicial DEVE ser 'pendente' (conforme regra)
                data: new Date().toISOString() // Data de envio no formato ISO
                
                // NOTA: O campo "data" no seu banco usa string ISO, não serverTimestamp.
                // Se preferir o timestamp do servidor do Firebase (mais robusto), mude para:
                // data: serverTimestamp() 
            };

            // 4. Enviar para o Firebase Realtime Database
            try {
                // Presume-se que 'db' é a referência ao seu Realtime Database inicializado
                const db = getDatabase(); 
                const sugestoesRef = ref(db, 'sugestoes_ecopontos');
                
                await push(sugestoesRef, novaSugestao);

                messageDisplay.textContent = 'Sugestão enviada com sucesso! Agradecemos sua contribuição.';
                messageDisplay.classList.add('success');
                form.reset();

            } catch (error) {
                console.error("Erro ao enviar a sugestão:", error);
                messageDisplay.textContent = 'Erro ao enviar. Tente novamente ou verifique sua conexão.';
                messageDisplay.classList.add('error');
            }
        });
    }
});
    </script>
</body>
</html>